(()=>{"use strict";var e={859:function(e,t,o){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getApp=void 0;const n=r(o(268)),i=r(o(577)),s=r(o(252)),u=r(o(461)),a=o(139),d=r(o(967)),c=o(490),l=o(424),v=o(37);t.getApp=()=>{const e=(0,s.default)(),t=(0,d.default)(),o=(0,u.default)();e.use(n.default.json()),e.use(n.default.urlencoded({extended:!0})),e.use(o.none()),e.disable("x-powered-by"),e.use((0,i.default)());const r=(0,c.newUserRepository)(t),f=(0,l.newUserService)(r),p=(0,v.newUserController)(f),y=(0,c.newBookRepository)(t),_=(0,l.newBookService)(y),g=(0,v.newBookController)(_),h=(0,c.newOrderRepository)(t),w=(0,l.newOrderService)(h,y,r),m=(0,v.newOrderController)(w),b=(0,l.newAuthService)(r),E=(0,v.newAuthController)(b);return(0,a.userRouter)(e,p),(0,a.authRouter)(e,E),(0,a.bookRouter)(e,g),(0,a.orderRouter)(e,m),e.use((function(e,t){return t.status(404).json({ok:!1,code:404,message:"Not Found"})})),e}},697:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(n,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function u(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,u)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=o(476);t.default=e=>({Register:(t,o)=>r(void 0,void 0,void 0,(function*(){try{const r=t.body,i=yield e.Register(r);(0,n.CustomResponse)(o,i)}catch(e){o.status(500).json({error:e.message})}})),Login:(t,o)=>r(void 0,void 0,void 0,(function*(){try{const r=t.body,i=yield e.Login(r);(0,n.CustomResponseWithToken)(o,i)}catch(e){o.status(500).json({error:e.message})}}))})},772:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(n,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function u(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,u)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=o(476);t.default=e=>({List:(t,o)=>r(void 0,void 0,void 0,(function*(){try{const r=t.query.page?parseInt(t.query.page):1,i=t.query.pageSize?parseInt(t.query.pageSize):10,s=t.query.search?t.query.search:"",u=yield e.List(r,i,String(s));(0,n.CustomResponseWithPagination)(o,u)}catch(e){o.status(500).json({error:e.message})}})),Create:(t,o)=>r(void 0,void 0,void 0,(function*(){try{const r=t.body,i=yield e.Create(r);(0,n.CustomResponse)(o,i)}catch(e){o.status(500).json({error:e.message})}}))})},37:function(e,t,o){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.newOrderController=t.newUserController=t.newBookController=t.newAuthController=void 0;var n=o(697);Object.defineProperty(t,"newAuthController",{enumerable:!0,get:function(){return r(n).default}});var i=o(772);Object.defineProperty(t,"newBookController",{enumerable:!0,get:function(){return r(i).default}});var s=o(626);Object.defineProperty(t,"newUserController",{enumerable:!0,get:function(){return r(s).default}});var u=o(747);Object.defineProperty(t,"newOrderController",{enumerable:!0,get:function(){return r(u).default}})},747:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(n,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function u(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,u)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=o(476);t.default=e=>({List:(t,o)=>r(void 0,void 0,void 0,(function*(){var r;try{const i=t.query.page?parseInt(t.query.page):1,s=t.query.pageSize?parseInt(t.query.pageSize):10,u=yield e.List(null===(r=t.user)||void 0===r?void 0:r.id,i,s);(0,n.CustomResponseWithPagination)(o,u)}catch(e){o.status(500).json({error:e.message})}})),Create:(t,o)=>r(void 0,void 0,void 0,(function*(){var r;try{const i=t.body;i.user_id=null===(r=t.user)||void 0===r?void 0:r.id;const s=yield e.Create(i);(0,n.CustomResponse)(o,s)}catch(e){o.status(500).json({error:e.message})}})),Delete:(t,o)=>r(void 0,void 0,void 0,(function*(){var r;try{const i=null===(r=t.params)||void 0===r?void 0:r.id,s=yield e.Delete(i);(0,n.CustomResponse)(o,s)}catch(e){o.status(500).json({error:e.message})}}))})},626:function(e,t){var o=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(n,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function u(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,u)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>({List:(t,r)=>o(void 0,void 0,void 0,(function*(){try{const t=yield e.List();r.json({data:t,message:"Success"})}catch(e){r.status(500).json({error:e.message})}})),Me:(t,r)=>o(void 0,void 0,void 0,(function*(){var o;try{const n=yield e.FindByEmail(null===(o=t.user)||void 0===o?void 0:o.email);r.json({data:n,message:"Success"})}catch(e){r.status(500).json({error:e.message})}}))})},416:function(e,t){var o=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(n,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function u(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,u)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>({List:(t,r,n)=>o(void 0,void 0,void 0,(function*(){const o=[null!=n?n:"",String(t),String(r)];return(yield e.query("SELECT * FROM books WHERE title ILIKE '%'||$1||'%' LIMIT $2 OFFSET $3",o)).rows})),Count:()=>o(void 0,void 0,void 0,(function*(){const t=yield e.query("SELECT COUNT(*) FROM books");return parseInt(t.rows[0].count,10)})),FindById:t=>o(void 0,void 0,void 0,(function*(){return(yield e.query("SELECT * FROM books WHERE id = $1",[t])).rows[0]})),Create:t=>o(void 0,void 0,void 0,(function*(){const{id:o,title:r,writer:n,point:i,tags:s,cover_image:u}=t||{},a=[o,r,n,null==i?void 0:i.toString(),null==s?void 0:s.toString(),"https://images-na.ssl-images-amazon.com/images/I/51Ga5GuElyL._AC_SX184_.jpg"];return(yield e.query("INSERT INTO books (id, title, writer, point, tags, cover_image ) VALUES ($1, $2, $3, $4, $5, $6) RETURNING *",a)).rows[0]}))})},490:function(e,t,o){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.newOrderRepository=t.newUserRepository=t.newBookRepository=void 0;var n=o(416);Object.defineProperty(t,"newBookRepository",{enumerable:!0,get:function(){return r(n).default}});var i=o(242);Object.defineProperty(t,"newUserRepository",{enumerable:!0,get:function(){return r(i).default}});var s=o(115);Object.defineProperty(t,"newOrderRepository",{enumerable:!0,get:function(){return r(s).default}})},115:function(e,t){var o=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(n,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function u(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,u)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>({List:(t,r,n)=>o(void 0,void 0,void 0,(function*(){const o=[t,String(r),String(n)];return(yield e.query("\n      SELECT o.id AS order_id, o.user_id, o.book_id, o.created_at,\n             b.id AS book_id, b.title, b.writer, b.cover_image, b.point, b.tags\n      FROM orders o\n      JOIN books b ON o.book_id = b.id\n      WHERE o.user_id = $1\n      LIMIT $2 OFFSET $3",o)).rows.map((e=>({id:e.order_id,user_id:e.user_id,book_id:e.book_id,book:{id:e.book_id,title:e.title,writer:e.writer,cover_image:e.cover_image,point:e.point,tags:e.tags},created_at:e.created_at})))})),Count:()=>o(void 0,void 0,void 0,(function*(){const t=yield e.query("SELECT COUNT(*) FROM orders");return parseInt(t.rows[0].count,10)})),FindById:t=>o(void 0,void 0,void 0,(function*(){return(yield e.query("SELECT * FROM orders WHERE id = $1",[t])).rows[0]})),FindByUserId:t=>o(void 0,void 0,void 0,(function*(){return(yield e.query("SELECT * FROM orders WHERE user_id = $1",[t])).rows[0]})),Create:t=>o(void 0,void 0,void 0,(function*(){const{id:o,book_id:r,user_id:n}=t||{},i=[o,r,n];return(yield e.query("INSERT INTO orders (id, book_id, user_id ) VALUES ($1, $2, $3) RETURNING *",i)).rows[0]})),Delete:t=>o(void 0,void 0,void 0,(function*(){const o=[t];yield e.query("DELETE FROM orders WHERE id = $1",o)}))})},242:function(e,t){var o=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(n,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function u(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,u)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>({List:()=>o(void 0,void 0,void 0,(function*(){return(yield e.query("SELECT * FROM users")).rows})),FindByEmail:t=>o(void 0,void 0,void 0,(function*(){return(yield e.query("SELECT * FROM users WHERE email = $1",[t])).rows[0]})),FindById:t=>o(void 0,void 0,void 0,(function*(){return(yield e.query("SELECT * FROM users WHERE id = $1",[t])).rows[0]})),Create:t=>o(void 0,void 0,void 0,(function*(){const{id:o,name:r,email:n,password:i}=t||{},s=[o,r,n,i];return(yield e.query("INSERT INTO users (id, name, email, password) VALUES ($1, $2, $3, $4) RETURNING *",s)).rows[0]})),UpdatePoint:t=>o(void 0,void 0,void 0,(function*(){try{const{id:o,points:r}=t||{},n="UPDATE users SET points = $2 WHERE id = $1 RETURNING *",i=[o,String(r)];return(yield e.query(n,i)).rows[0]||null}catch(e){return console.error("Error updating user:",e),null}}))})},633:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(n,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function u(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,u)}a((r=r.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(403),s=o(449),u=o(903),a=o(437),d=n(o(829)),c=o(992);t.default=e=>({Register:t=>r(void 0,void 0,void 0,(function*(){try{const o=new a.RegisterDto;o.name=t.name,o.email=t.email,o.password=t.password;const r=yield(0,i.validate)(o);if(r.length>0)return{data:null,message:null==r?void 0:r.toString(),code:400};const n=yield(0,s.EncryptPassword)(t.password);return{data:yield e.Create({id:(0,u.v4)(),email:t.email,name:t.name,password:n}),message:"User created successfully",code:201}}catch(e){throw new Error(`Error post users: ${e.message}`)}})),Login:t=>r(void 0,void 0,void 0,(function*(){try{const o=new a.LoginDto;o.email=t.email,o.password=t.password;const r=yield(0,i.validate)(o);if(r.length>0)return{data:null,message:null==r?void 0:r.toString(),code:400};const n=yield e.FindByEmail(t.email);return n?(yield(0,s.ComparePassword)(null==n?void 0:n.password,null==t?void 0:t.password))?{token:d.default.sign({email:n.email,id:n.id},c.JWT_SECRET,{expiresIn:"1h"}),data:n,message:"User login successfully",code:200}:{data:null,message:"Incorrect password",code:401}:{data:null,message:"User not found",code:404}}catch(e){throw new Error(`Error post users: ${e.message}`)}}))})},866:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(n,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function u(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,u)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=o(665),i=o(903),s=o(403);t.default=e=>({List:(t,o,n)=>r(void 0,void 0,void 0,(function*(){try{const r=(t-1)*o,i=o,s=yield e.List(i,r,n),u=yield e.Count(),a=Math.ceil(u/o);return{data:s,message:"Books loaded successfully",code:200,pagination:{page:t,pageSize:o,totalPages:a}}}catch(e){throw new Error(`Error getting all books: ${e.message}`)}})),Create:t=>r(void 0,void 0,void 0,(function*(){try{const o=new n.BookDto;o.title=t.title,o.writer=t.writer,o.point=t.point,o.tags=t.tags;const r=yield(0,s.validate)(o);return r.length>0?{data:null,message:null==r?void 0:r.toString(),code:400}:{data:yield e.Create({id:(0,i.v4)(),point:t.point,title:t.title,tags:`{${t.tags.join(",")}}`,writer:t.writer}),message:"Book created successfully",code:201}}catch(e){throw new Error(`Error getting all books: ${e.message}`)}}))})},424:function(e,t,o){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.newOrderService=t.newBookService=t.newAuthService=t.newUserService=void 0;var n=o(128);Object.defineProperty(t,"newUserService",{enumerable:!0,get:function(){return r(n).default}});var i=o(633);Object.defineProperty(t,"newAuthService",{enumerable:!0,get:function(){return r(i).default}});var s=o(866);Object.defineProperty(t,"newBookService",{enumerable:!0,get:function(){return r(s).default}});var u=o(113);Object.defineProperty(t,"newOrderService",{enumerable:!0,get:function(){return r(u).default}})},113:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(n,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function u(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,u)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=o(403),i=o(748),s=o(903);t.default=(e,t,o)=>({List:(t,o,n)=>r(void 0,void 0,void 0,(function*(){try{const r=(o-1)*n,i=n,s=yield e.List(t,i,r),u=yield e.Count(),a=Math.ceil(u/n);return{data:s,message:"Orders loaded successfully",code:200,pagination:{page:o,pageSize:n,totalPages:a}}}catch(e){throw new Error(`Error getting all orders: ${e.message}`)}})),Create:u=>r(void 0,void 0,void 0,(function*(){try{const r=new i.OrderDto;r.book_id=u.book_id;const a=yield(0,n.validate)(r);if(a.length>0)return{data:null,message:null==a?void 0:a.toString(),code:400};const d=yield t.FindById(r.book_id),c=yield o.FindById(null==u?void 0:u.user_id);return yield o.UpdatePoint({id:null==u?void 0:u.user_id,points:Number(null==c?void 0:c.points)-Number(null==d?void 0:d.point)}),{data:yield e.Create({id:(0,s.v4)(),book_id:r.book_id,user_id:null==u?void 0:u.user_id}),message:"Order created successfully",code:201}}catch(e){throw new Error(`Error creating order: ${e.message}`)}})),Delete:n=>r(void 0,void 0,void 0,(function*(){try{const r=yield e.FindById(n),i=yield t.FindById(null==r?void 0:r.book_id),s=yield o.FindById(null==r?void 0:r.user_id);return yield o.UpdatePoint({id:null==s?void 0:s.id,points:Number(null==s?void 0:s.points)+Number(null==i?void 0:i.point)}),yield e.Delete(n),{data:null,message:"Order deleted successfully",code:200}}catch(e){throw new Error(`Error creating order: ${e.message}`)}}))})},128:function(e,t){var o=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(n,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function u(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,u)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.default=e=>({List:()=>o(void 0,void 0,void 0,(function*(){try{return yield e.List()}catch(e){throw new Error(`Error getting all users: ${e.message}`)}})),FindByEmail:t=>o(void 0,void 0,void 0,(function*(){try{return yield e.FindByEmail(t)}catch(e){throw new Error(`Error getting all users: ${e.message}`)}}))})},967:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=o(830),n=o(992);t.default=()=>{const e=new r.Pool({user:n.DB_USER,host:n.DB_HOST,database:n.DB_DATABASE,password:n.DB_PASS,port:Number(n.DB_PORT),ssl:!0});return e.on("connect",(()=>{console.log(`Connected to database at ${n.DB_HOST}`)})),e.on("error",(e=>{console.error("Error connecting to database: ",e.message),process.exit(-1)})),e}},992:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.JWT_SECRET=t.DB_DATABASE=t.DB_PASS=t.DB_USER=t.DB_PORT=t.DB_HOST=t.APP_PORT=void 0,(0,o(818).configDotenv)(),t.APP_PORT=process.env.APP_PORT||"3000",t.DB_HOST=process.env.DB_HOST||"localhost",t.DB_PORT=process.env.DB_PORT||"5432",t.DB_USER=process.env.DB_USER||"",t.DB_PASS=process.env.DB_PASS||"",t.DB_DATABASE=process.env.DB_DATABASE||"",t.JWT_SECRET=process.env.JWT_SECRET||"123"},437:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var u=e.length-1;u>=0;u--)(n=e[u])&&(s=(i<3?n(s):i>3?n(t,o,s):n(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.LoginDto=t.RegisterDto=void 0;const n=o(403);class i{}t.RegisterDto=i,r([(0,n.IsNotEmpty)(),(0,n.IsString)()],i.prototype,"name",void 0),r([(0,n.IsNotEmpty)(),(0,n.IsEmail)()],i.prototype,"email",void 0),r([(0,n.IsNotEmpty)(),(0,n.IsString)()],i.prototype,"password",void 0);class s{}t.LoginDto=s,r([(0,n.IsNotEmpty)(),(0,n.IsEmail)()],s.prototype,"email",void 0),r([(0,n.IsNotEmpty)(),(0,n.IsString)()],s.prototype,"password",void 0)},665:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var u=e.length-1;u>=0;u--)(n=e[u])&&(s=(i<3?n(s):i>3?n(t,o,s):n(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.BookDto=void 0;const n=o(403);class i{}t.BookDto=i,r([(0,n.IsNotEmpty)(),(0,n.IsString)()],i.prototype,"title",void 0),r([(0,n.IsNotEmpty)(),(0,n.IsString)()],i.prototype,"writer",void 0),r([(0,n.IsNotEmpty)(),(0,n.IsString)()],i.prototype,"point",void 0),r([(0,n.IsArray)(),(0,n.IsNotEmpty)({each:!0})],i.prototype,"tags",void 0)},748:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var u=e.length-1;u>=0;u--)(n=e[u])&&(s=(i<3?n(s):i>3?n(t,o,s):n(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.OrderDto=void 0;const n=o(403);class i{}t.OrderDto=i,r([(0,n.IsNotEmpty)(),(0,n.IsString)()],i.prototype,"book_id",void 0)},449:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(n,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function u(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,u)}a((r=r.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ComparePassword=t.EncryptPassword=t.AuthenticateToken=void 0;const i=n(o(486)),s=n(o(829)),u=o(992),a=o(476);t.AuthenticateToken=(e,t,o)=>{var r;const n=(null===(r=e.headers.authorization)||void 0===r?void 0:r.split(" ")[1])||e.query.token;if(!n)return(0,a.CustomResponse)(t,{code:401,message:"Authentication failed: Token not provided",data:null});try{const t=s.default.verify(String(n),u.JWT_SECRET);e.user=t,o()}catch(e){return(0,a.CustomResponse)(t,{code:401,message:"Authentication failed: Invalid token",data:null})}},t.EncryptPassword=e=>r(void 0,void 0,void 0,(function*(){try{return yield i.default.hash(e,10)}catch(e){throw new Error("Error encrypting password")}})),t.ComparePassword=(e,t)=>r(void 0,void 0,void 0,(function*(){try{return yield i.default.compare(t,e)}catch(e){throw new Error("Error comparing passwords")}}))},476:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CustomResponseWithPagination=t.CustomResponseWithToken=t.CustomResponse=void 0,t.CustomResponse=(e,t)=>{e.status(null==t?void 0:t.code).json({data:null==t?void 0:t.data,message:null==t?void 0:t.message})},t.CustomResponseWithToken=(e,t)=>{e.status(null==t?void 0:t.code).json({data:null==t?void 0:t.data,message:null==t?void 0:t.message,token:null==t?void 0:t.token})},t.CustomResponseWithPagination=(e,t)=>{e.status(null==t?void 0:t.code).json({data:null==t?void 0:t.data,message:null==t?void 0:t.message,pagination:null==t?void 0:t.pagination})}},542:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=(e,t)=>{e.post("/register",t.Register),e.post("/login",t.Login)}},109:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=o(449);t.default=(e,t)=>{e.get("/books",r.AuthenticateToken,t.List),e.post("/books",t.Create)}},139:function(e,t,o){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.orderRouter=t.userRouter=t.bookRouter=t.authRouter=void 0;var n=o(542);Object.defineProperty(t,"authRouter",{enumerable:!0,get:function(){return r(n).default}});var i=o(109);Object.defineProperty(t,"bookRouter",{enumerable:!0,get:function(){return r(i).default}});var s=o(567);Object.defineProperty(t,"userRouter",{enumerable:!0,get:function(){return r(s).default}});var u=o(95);Object.defineProperty(t,"orderRouter",{enumerable:!0,get:function(){return r(u).default}})},95:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=o(449);t.default=(e,t)=>{e.get("/orders",r.AuthenticateToken,t.List),e.post("/orders",r.AuthenticateToken,t.Create),e.delete("/orders/:id",r.AuthenticateToken,t.Delete)}},567:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=o(449);t.default=(e,t)=>{e.get("/users",r.AuthenticateToken,t.List),e.get("/users/me",r.AuthenticateToken,t.Me)}},486:e=>{e.exports=require("bcrypt")},268:e=>{e.exports=require("body-parser")},403:e=>{e.exports=require("class-validator")},577:e=>{e.exports=require("cors")},818:e=>{e.exports=require("dotenv")},252:e=>{e.exports=require("express")},829:e=>{e.exports=require("jsonwebtoken")},461:e=>{e.exports=require("multer")},830:e=>{e.exports=require("pg")},903:e=>{e.exports=require("uuid")}},t={};function o(r){var n=t[r];if(void 0!==n)return n.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,o),i.exports}(()=>{const e=o(859),t=o(992);(()=>{try{(0,e.getApp)().listen(t.APP_PORT,(()=>{console.log(`server started at http://localhost:${t.APP_PORT}`)}))}catch(e){console.error(e)}})()})()})();